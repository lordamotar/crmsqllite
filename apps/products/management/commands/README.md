# Универсальная команда импорта данных

## Описание
Команда `universal_import` объединяет все функции импорта данных из Excel файла в одну команду.

## Использование

### Базовое использование
```bash
python manage.py universal_import other/1610.xlsx
```

### С ограничением количества строк
```bash
python manage.py universal_import other/1610.xlsx --limit 1000
```

### Только анализ файла (без импорта)
```bash
python manage.py universal_import other/1610.xlsx --analyze-only
```

### Очистка и импорт
```bash
# Очистить товары и импортировать заново
python manage.py universal_import other/1610.xlsx --clear-products

# Очистить заказы и товары
python manage.py universal_import other/1610.xlsx --clear-products --clear-orders
```

### Импорт с проверкой данных
```bash
python manage.py universal_import other/1610.xlsx --check-data
```

### Полный импорт с очисткой и проверкой
```bash
python manage.py universal_import other/1610.xlsx --clear-products --check-data
```

## Параметры

- `file_path` - Путь к Excel файлу (обязательный)
- `--limit N` - Максимальное количество строк для обработки
- `--clear-products` - Очистить существующие товары перед импортом
- `--clear-orders` - Очистить существующие заказы перед импортом
- `--analyze-only` - Только анализ файла без импорта
- `--check-data` - Проверить данные в базе после импорта

## Что импортируется

### Товары (Product)
- Код товара (колонка 0)
- Наименование (колонка 1)
- Отбор плана продаж (колонка 133)
- Размерность (колонка 134)
- Тип шины (колонка 135)
- Сезонность (колонка 136)
- Ассортиментная группа (колонка 137)
- Оптовая цена (колонка 129)
- Акционная цена (колонка 130)
- Розничная цена (колонка 132)

### Группы товаров (ProductGroup)
Автоматически создаются 12 предопределенных групп:
1. АВТОШИНЫ ИМПОРТНЫЕ ЛЕГКОВЫЕ ЗИМНИЕ
2. АВТОШИНЫ ЛЕГКОВЫЕ
3. АВТОШИНЫ ЛЕГКОГРУЗОВЫЕ
4. АВТОШИНЫ ИМПОРТНЫЕ ЛЕГКОВЫЕ
5. АВТОШИНЫ ГРУЗОВЫЕ
5.1. ШИНОКОМПЛЕКТ (ШИНЫ + ДИСКИ)
6. АВТОШИНЫ ДЛЯ СПЕЦТЕХНИКИ-Б/Г
7. СЕЛЬХОЗШИНЫ
8. КАМЕРЫ
9. ФЛИПЕРА
9а. МОТО-ВЕЛОШИНЫ
9г. ДИСКИ-КОЛПАКИ

## Примеры вывода

### Анализ файла
```
=== АНАЛИЗ ФАЙЛА ===
Общее количество строк: 25059
Количество колонок: 200
Первые 3 строки:
  1. Код: 0005656809... Название: 155/70R13 Ice Blazer WSL2 75T Sailun...
  2. Код: 0005667288... Название: 155/70R13 Ice Blazer WST3 75T Sailun...
  3. Код: 00-00075437... Название: 155/70R13 Nordman 5 75T Ikon...
```

### Импорт товаров
```
=== ИМПОРТ ТОВАРОВ ===
Создана группа: 1 - АВТОШИНЫ ИМПОРТНЫЕ ЛЕГКОВЫЕ ЗИМНИЕ
Создана группа: 2 - АВТОШИНЫ ЛЕГКОВЫЕ
...
Создано товаров: 100
Создано товаров: 200
...
Создано товаров: 10199
Обновлено товаров: 0
```

### Проверка данных
```
=== ПРОВЕРКА ДАННЫХ ===
Всего товаров: 10199
С ассортиментной группой: 9819
С типом шины: 0
С сезонностью: 7827
С ценами: 10199
Групп товаров: 12
```

## Обновление через сайт

При обновлении товаров через сайт (кнопка "Обновить" в списке товаров):

- ✅ **Заказы НЕ удаляются** - все существующие заказы остаются в базе
- ✅ **Товары обновляются** - существующие товары обновляются данными из файла
- ✅ **Новые товары добавляются** - товары, которых нет в базе, создаются
- ✅ **Отсутствующие товары удаляются** - товары, которых нет в файле, удаляются из базы

Это обеспечивает синхронизацию каталога товаров с актуальными данными из Excel файла.

## Примечания

- Команда автоматически пропускает пустые строки и заголовки
- Группы товаров определяются по ключевым словам в названии
- Цены парсятся автоматически из соответствующих колонок
- Все операции выполняются в транзакциях для безопасности данных
